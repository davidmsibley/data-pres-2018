!(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@uirouter/core")):"function"==typeof define&&define.amd?define(["@uirouter/core"],e):e((t=t||self).common)})(this,function(t){"use strict";const e=L.CircleMarker.extend({getEvents:function(){return{zoomend:this._restyle,filterpoints:this._filter}},_restyle:function(t){this.setRadius(e.calcRadius(t.target.getZoom()))},_filter:function(t){t.detail.resolve(this.feature.properties)?this.setStyle({stroke:!0,fill:!0}):this.setStyle({stroke:!1,fill:!1})},highlight:function(){this._activeBackup=this.options.color,this.setStyle({color:"orange"})},removeHighlight:function(){this._activeBackup&&(this.setStyle({color:this._activeBackup}),this._activeBackup=null)}});e.calcRadius=(t=>Math.max(t/1.5,3));class i extends window.L.Evented{constructor(){super(),this.selected=!1,this._highlight=null;const t=this.map=L.map("map",{zoomControl:!1}).setView([45,-89.623861],7);this.el=document.querySelector("#map"),new L.Control.Zoom({position:"topright"}).addTo(t);var o=[L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',label:"OpenStreetMap Humanitarian"}).addTo(t),L.esri.basemapLayer("Imagery",{label:"Esri Satellite"})];t.addControl(L.control.basemaps({basemaps:o,tileX:0,tileY:0,tileZ:1}));let r=this.bore=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/borehole_geophysics/MapServer/0",pointToLayer:function(i,o){return new e(o,{weight:2,radius:e.calcRadius(t.getZoom())})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this)),n=this.quat=L.esri.featureLayer({url:"https://data.wgnhs.wisc.edu/arcgis/rest/services/geologic_data/sediment_core/MapServer/0",pointToLayer:function(i,o){return new e(o,{weight:2,color:"#33AA44",radius:e.calcRadius(t.getZoom())})}}).on("click",function(t){this._highlight!==t.propagatedFrom?this.fire("interaction",t.propagatedFrom.feature.properties):this.fire("interaction")}.bind(this));this.layers=[r,n],Promise.all([new Promise(function(t,e){r.once("load",function(){t()})}),new Promise(function(t,e){n.once("load",function(){t()})})]).then(function(){let t={};this.layers.forEach(function(e){e.eachFeature(function(e){let o=i.getSiteCode(e.feature.properties);e.feature.properties.Site_Code=o,e.feature.properties.Latitude=e.getLatLng().lat,e.feature.properties.Longitude=e.getLatLng().lng,t[o]=e})}),this._lookup=t,this.fire("init")}.bind(this)),r.addTo(t),n.addTo(t)}static getSiteCode(t){return["Wid","ID","Site_Code"].reduce((e,i)=>e||t[i],void 0)}getPoint(t){return this._lookup[i.getSiteCode(t)]}zoomToPoint(t){let e=this.getPoint(t);e&&this.map.setZoomAround(e.getLatLng(),15)}getHighlightPoint(){return this._highlight}setHighlightPoint(t){t?(this._highlight=t,this._highlight.bringToFront(),this._highlight.highlight()):this.clearSelection()}selectPoint(t){let e=null,i=this.getPoint(t);if(i){e=i.feature.properties,i!==this.getHighlightPoint()&&(this.clearSelection(),this.setHighlightPoint(i))}return e}clearSelection(){this._highlight&&(this._highlight.bringToBack(),this._highlight.removeHighlight()),this._highlight=null}setVisibility(t){t?(this.el.removeAttribute("data-closed"),this.map.invalidateSize()):this.el.setAttribute("data-closed",!0)}}class o{constructor(...t){this._aggrKeys=[],this.aggrData=[];for(let e of t)this.aggrData.push(o._gatherAggrData(e,this._aggrKeys))}static _gatherAggrData(t,e){const i={aggr:{},data:[]};return t.eachFeature(function(t,o){let r={};e.forEach(function(e){r[e]=t.feature.properties[e],i.aggr[e]||(i.aggr[e]={}),r[e]&&"number"==typeof r[e]&&((!i.aggr[e].max||i.aggr[e].max<r[e])&&(i.aggr[e].max=r[e]),(!i.aggr[e].min||i.aggr[e].min>r[e])&&(i.aggr[e].min=r[e]))}),i.data.push(r)}),i}}const r="entry";window.siteMap=new i,window.sidebar=document.querySelector("#sidebar"),window.siteMap.once("init",function(){window.siteData=new o(window.siteMap.bore,window.siteMap.quat),window.aggrData=siteData.aggrData;var e=function(){document.dispatchEvent(new CustomEvent("toggle-pdf",{bubbles:!0,detail:{closed:!0}})),document.querySelectorAll("site-details").forEach(function(t){t.siteinfo=null}),document.querySelectorAll("pdf-view").forEach(function(t){t.pdfsrc=null})};async function i(t){return e(),document.querySelectorAll("site-details").forEach(function(e){e.siteinfo=t}),document.querySelectorAll("pdf-view").forEach(function(e){e.pdfsrc=t.Wid?"https://data.wgnhs.wisc.edu/geophysical-logs/"+t.Wid+".pdf":null}),!0}window.router=new class extends window.L.Evented{constructor(){super(),this.router=new t.UIRouter,this.router.plugin(t.pushStateLocationPlugin),this.router.plugin(t.servicesPlugin),this.routes={}}start(){this.router.urlService.rules.initial({state:r}),this.router.urlService.rules.otherwise({state:r}),this.router.urlService.listen(),this.router.urlService.sync()}addRoute(t){t&&t.name&&(this.routes[t.name]=t,this.router.stateRegistry.register(t))}clearRoute(){this.setRoute()}setRoute(t,e){arguments.length>0&&this.routes[t]?this.router.stateService.go(t,e):this.router.stateService.go(r)}link(t,e){let i="";return i=e?this.router.stateService.href(t,e):this.router.stateService.href(t)}},window.router.addRoute({name:"entry",url:"/",onEnter:function(t,i){window.siteMap.clearSelection(),e(),document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("default"),window.siteMap.setVisibility(!0)},onExit:function(t,e){}}),window.router.addRoute({name:"view",url:"/view/:Site_Code",onEnter:function(t,e){let o=t.params(),r=window.siteMap.selectPoint(o);r?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!1}),i(r).then(()=>{document.querySelector("#app").setAttribute("data-view","app"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!0)})):window.router.clearRoute()},onExit:function(t,e){}}),window.router.addRoute({name:"print",url:"/print/:Site_Code",onEnter:function(t,e){let o=t.params(),r=window.siteMap.selectPoint(o);r?(document.querySelectorAll("site-details").forEach(function(t){t.printLayout=!0}),i(r).then(()=>{document.querySelector("#app").removeAttribute("data-view"),window.sidebar.switchTab("details"),window.siteMap.setVisibility(!1)})):window.router.clearRoute()},onExit:function(t,e){}}),window.router.start(),window.siteMap.on("interaction",t=>{t.Site_Code?window.router.setRoute("view",t):window.router.clearRoute()})}),document.addEventListener("clear-selection",function(t){window.router.clearRoute()}),document.addEventListener("toggle-print",function(t){t.detail.on?window.router.setRoute("print",t.detail.params):window.router.setRoute("view",t.detail.params)}),document.addEventListener("toggle-pdf",function(t){window.siteMap.setVisibility(t.detail.closed)})});
//# sourceMappingURL=index.min.js.map
